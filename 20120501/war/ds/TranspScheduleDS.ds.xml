<DataSource
	ID="TranspScheduleDS"
	serverType="sql"
	tableName="transp_schedules"
	qualifyColumnNames="false"
	dropExtraFields = "false">
	
	<fields>
		<field name="transp_schedule_id"		type="integer"		title="transp_schedule_id"		hidden="true"	primaryKey="true" />
		<field name="transp_type_id"			type="integer"		title="transp_type_id" 			hidden="true"/>
		<field name="depart_transp_stat_id"		type="integer"		title="depart_transp_stat_id" 	hidden="true"/>
		<field name="arrival_transp_stat_id"	type="integer"		title="arrival_transp_stat_id" 	hidden="true"/>
		<field name="transp_comp_id"			type="integer"		title="transp_comp_id" 			hidden="true"/>
		<field name="transp_res_id"				type="integer"		title="transp_res_id" 			hidden="true"/>
		<field name="loggedUserName"			type="text"			title="Logged UserName" 		hidden="true"/>
		<field name="ostation"					type="text"			title="ostation" 				hidden="true"/>
		<field name="istation"					type="text"			title="istation" 				hidden="true"/>
		<field name="depart_city"				type="text"			title="depart_city" 			hidden="true"/>
		<field name="arrival_city"				type="text"			title="arrival_city" 			hidden="true"/>
		<field name="cmt"						type="text"			title="cmt" 					hidden="true"/>
		<field name="days"						type="integer"		title="days"					hidden="true"/>
		<field name="important"					type="integer"		title="important" 				hidden="true"/>
		<field name="depart_time"				type="datetime"		title="depart_time"				hidden="true"/>
		<field name="arrival_time"				type="datetime"		title="arrival_time"			hidden="true"/>
		<field name="days_descr"				type="text"			title="days_descr"/>
		<field name="transp_model_descr"		type="text"			title="transp_model_descr"/>
		<field name="remark"					type="text"			title="remark"/>
		<field name="transport_type"			type="text"			title="transport_type"/>
		<field name="currDateTime"				type="text"			title="currDateTime"/>
		<field name="price_descr"				type="text"			title="price_descr"/>		
		<field name="depart_station"			type="text"			title="depart_station"/>
		<field name="arrival_station"			type="text"			title="arrival_station"/>
		<field name="transp_company"			type="text"			title="transp_company"/>
		<field name="transp_resource"			type="text"			title="transp_resource"/>
		<field name="formated_depart_time"		type="text"			title="formated_depart_time"/>
		<field name="formated_arrival_time"		type="text"			title="formated_arrival_time"/>												
		<field name="departureCity"				type="text"			title="departureCity"/>
		<field name="departureStation"			type="text"			title="departureStation"/>
	</fields>

	<operationBindings>		

		<serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.TransportDMI"/>
		<!-- Add Transport -->
		<operationBinding operationType="add" operationId="addTransport" serverMethod="addTransport">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.TransportDMI"/>
        </operationBinding>
        
		<!-- Transport Update -->
		<operationBinding operationType="update" operationId="updateTransport" serverMethod="updateTransport">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.TransportDMI"/>
        </operationBinding>
        
        <!-- Transport Remove -->
		<operationBinding operationType="remove" operationId="removeTransport" serverMethod="removeTransport">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.TransportDMI"/>
        </operationBinding>
	
    	<operationBinding operationId="searchAllTransports" operationType="fetch">
    		<selectClause>   			
    			ts.transp_schedule_id,
				ts.days,
				getdaysdescription(ts.days) as days_descr,
				ts.arrival_time,
				ts.arrival_transp_stat_id,
				ts.important,
				ts.remark,
				ts.depart_time,
				ts.depart_transp_stat_id,
				ts.transp_comp_id,    
				ts.transp_res_id,    
				ts.price_descr,
				ts.transp_type_id,        
				ts.transp_model_descr,
				tt.name_descr as transport_type,
				oc.city_name_geo||' '||o.name_descr as depart_station,
				ic.city_name_geo||' '||i.name_descr as arrival_station,
				tc.name_descr as transp_company,
				tp.name_descr as transp_resource,
				oc.city_name_geo as depart_city,
				ic.city_name_geo as arrival_city,
				to_char((ts.arrival_time+ic.of_gmt/24),'HH24:mi') cmt,
				to_char(ts.depart_time,'HH24:MI') formated_depart_time,
       			to_char(ts.arrival_time ,'HH24:MI') formated_arrival_time
			</selectClause> 
			<tableClause>ccare.transp_schedules ts, transp_types tt,transp_stations o, cities oc,transp_stations i, cities ic, transp_companies tc, transp_resource tp</tableClause>
			<whereClause><![CDATA[
					ts.transp_type_id = tt.transp_type_id and
					ts.depart_transp_stat_id = o.transp_stat_id and o.city_id = oc.city_id and
					ts.arrival_transp_stat_id = i.transp_stat_id and i.city_id = ic.city_id and
					ts.transp_comp_id = tc.transp_comp_id(+) and
					ts.transp_res_id = tp.transp_res_id(+)  
					#if($criteria.transp_type_id) and ts.transp_type_id = $criteria.transp_type_id #end
					#if($criteria.depart_transp_stat_id) and ts.depart_transp_stat_id = $criteria.depart_transp_stat_id #end
					#if($criteria.arrival_transp_stat_id) and ts.arrival_transp_stat_id = $criteria.arrival_transp_stat_id #end
					#if($criteria.transp_comp_id) and ts.transp_comp_id = $criteria.transp_comp_id #end
					#if($criteria.transp_res_id) and ts.transp_res_id = $criteria.transp_res_id #end
					#if($criteria.remark) and ts.remark like '%'||($criteria.remark)||'%' #end					
					#if($criteria.transp_model_descr) and ts.transp_model_descr like '%'||($criteria.transp_model_descr)||'%' #end
					#if($criteria.depart_city) and oc.city_name_geo like '%'||($criteria.depart_city)||'%' #end
					#if($criteria.arrival_city) and ic.city_name_geo like '%'||($criteria.arrival_city)||'%' #end
					#if($criteria.depart_station) and o.name_descr like '%'||($criteria.depart_station)||'%' #end
					#if($criteria.arrival_station) and i.name_descr like '%'||($criteria.arrival_station)||'%' #end					
					#if($criteria.o_city_id) and oc.city_id = $criteria.o_city_id #end
					#if($criteria.i_city_id) and ic.city_id = $criteria.i_city_id #end
					#if($criteria.o_country_id) and oc.country_id = $criteria.o_country_id #end
					#if($criteria.i_country_id) and ic.country_id = $criteria.i_country_id #end
					#if($criteria.c_days) and (bitand(t.days,$criteria.c_days) = $criteria.c_days OR t.days = 0)   #end
					#if($criteria.co_days) and (bitand(t.days,$criteria.co_days) = $criteria.co_days OR t.days = 0) #end
				]]>  
			</whereClause> 
			<orderClause>ts.days</orderClause>
    	</operationBinding>
    	
    	<operationBinding operationId="searchAllTransportsInner" operationType="fetch">
    		<selectClause>   			
    			t.transp_schedule_id,
    			t.out_time as formated_depart_time,
    			t.in_time as formated_arrival_time,
    			t.outCity as depart_city,
    			t.outPlace as arrival_city
			</selectClause> 
			<tableClause>search_transp_stops t</tableClause>
			<whereClause><![CDATA[
					1 = 1
					#if($criteria.transp_schedule_id) and t.transp_schedule_id = $criteria.transp_schedule_id #end
					#if($criteria.outCity) and t.outCity like '%'||($criteria.outCity)||'%' #end
					#if($criteria.departureplace) and t.departureplace like '%'||($criteria.departureplace)||'%' #end
				]]>  
			</whereClause> 
    	</operationBinding>
    	
    	
    	<operationBinding operationId="getExactTime" operationType="fetch">
    		<selectClause>   			
    			to_char(sysdate,'DD-MM-YYYY  HH24:MI:SS') as currDateTime
			</selectClause> 
			<tableClause>dual</tableClause>
    	</operationBinding>
    	
    </operationBindings>	
</DataSource>