<DataSource 
	ID="PhoneViewDS" 
	serverType="sql"
	tableName="v_full_phone" 
	qualifyColumnNames="false"
	dropExtraFields = "false">
	<fields>
		<field name="phone"								type="text"						title="phone"/>
		<field name="owner_type"						type="integer"					title="owner_type"						hidden="true"/>
		<field name="owner_id"							type="integer"					title="owner_id" 						hidden="true"/>
		<field name="owner_type_descr"					type="text"						title="owner_type_descr" 				hidden="true"/>
		<field name="full_name"							type="text"						title="full_name"/>
		<field name="addr_id"							type="integer"					title="addr_id" 						hidden="true"/>
		<field name="address"							type="text"						title="address"/>
		<field name="address_hidden_by_request"			type="integer"					title="address_hidden_by_request"		hidden="true"/>
		<field name="address_hidden_by_request_des"		type="text"						title="address_hidden_by_request_des"	hidden="true"/>
		<field name="phone_hidden_by_request"			type="integer"					title="phone_hidden_by_request" 		hidden="true"/>
		<field name="phone_hidden_by_request_desc"		type="text"						title="phone_hidden_by_request_desc"	hidden="true"/>
		<field name="phone_contract_type"				type="integer"					title="phone_contract_type" 			hidden="true"/>
		<field name="phone_contract_type_desc"			type="text"						title="phone_contract_type_desc"		hidden="true"/>
		<field name="phone_state_id"					type="integer"					title="phone_state_id" 					hidden="true"/>
		<field name="phone_state_id_desc"				type="text"						title="phone_state_id_desc" 			hidden="true"/>
		<field name="phone_type_id"						type="integer"					title="phone_type_id" 					hidden="true"/>
		<field name="phone_type_id_desc"				type="text"						title="phone_type_id_desc" 				hidden="true"/>
		<field name="is_parallel"						type="integer"					title="is_parallel" 					hidden="true"/>
		<field name="is_parallel_descr"					type="text"						title="is_parallel_descr" 				hidden="true"/>
		<field name="for_contact"						type="integer"					title="for_contact" 					hidden="true"/>
		<field name="for_contact_desr"					type="text"						title="for_contact_desr" 				hidden="true"/>
		<field name="super_priority"					type="integer"					title="super_priority" 					hidden="true"/>
		<field name="important_remark"					type="integer"					title="important_remark" 				hidden="true"/>
		<field name="status"							type="integer"					title="status" 							hidden="true"/>
		<field name="full_hidden"						type="integer"					title="full_hidden" 					hidden="true"/>
		<field name="parrent_organization_id"			type="integer"					title="parrent_organization_id" 		hidden="true"/>
		<field name="town_id"							type="integer"					title="town_id" 						hidden="true"/>
		<field name="town_name"							type="text"						title="status"/>
		<field name="phone_shown"						type="text"						title="phone_shown"/>
		<field name="concat_address" 					type="text"						title="address"/>
		<field name="real_address" 						type="text"						title="address"/>
		<field name="real_town" 						type="text"						title="address"/>
		<field name="full_name_reverse" 				type="text"						title="address"/>
		<field name="organization_id"					type="integer"					title="organization_id" 				hidden="true"/>
		<field name="proceeded" 						type="boolean"   				title="need_organisation" 				sqlStorageStrategy="integer"/>
	</fields>
	
	<operationBindings>
		<operationBinding operationId="customSearch"
			operationType="fetch">			
			<selectClause>
				phone,
				owner_type, 
				owner_id, 
				
				#if($criteria.isCallCenter)
					decode(t.full_hidden,1, map_char_codes_geo('dafaruli'),t.full_name) as full_name,
					decode(t.full_hidden,1, map_char_codes_geo('dafaruli'),t.owner_type_descr) as owner_type_descr,
					decode(t.full_hidden,1, map_char_codes_geo('dafaruli'),t.town_name) as town_name,
					decode(t.full_hidden,1, map_char_codes_geo('dafaruli'),t.phone_shown) as phone_shown,
					decode(t.full_hidden,1, map_char_codes_geo('dafaruli'),t.phone_contract_type_desc) as phone_contract_type_desc,
				#else
					t.full_name as full_name,
					t.owner_type_descr as owner_type_descr,
					t.town_name as town_name,
					t.phone_shown as phone_shown,
					t.phone_contract_type_desc as phone_contract_type_desc,
				#end
				addr_id, 
				super_priority, 
				important_remark, 
				status, 
				address, 
				address_hidden_by_request, 
				address_hidden_by_request_des, 
				phone_hidden_by_request, 
				phone_hidden_by_request_desc, 
				phone_contract_type, 
				phone_state_id, 
				parrent_organization_id,
				phone_state_id_desc, 
				phone_type_id, 
				phone_type_id_desc, 
				is_parallel, 
				is_parallel_descr, 
				for_contact, 
				for_contact_desr,
				town_id,
				organization_id,
				#if($criteria.isCallCenter)
					decode(t.full_hidden,1, map_char_codes_geo('dafaruli'),t.concat_address) as concat_address
				#else
					concat_address
					
					#if($criteria.reall_address)
						,real_town||' - '||real_address real_address,
						full_name_reverse,
						decode(owner_type,0,
							decode(#if($criteria.subscriber_proceeded)$criteria.subscriber_proceeded #else -1 #end,owner_id,1,0), 
							is_In_string(to_char(owner_id),#if($criteria.organization_proceeded)$criteria.organization_proceeded #else '' #end)
						) proceeded
						
					#end
				#end
					
			</selectClause>
			<tableClause>
			  	   v_full_phone              t
       		</tableClause>
			<whereClause><![CDATA[ 
				   	1 = 1
					#if($criteria.phone) AND t.phone = $criteria.phone #end
					#if($criteria.phone_like) AND t.phone like $criteria.phone_like ||'%' #end
					#if($criteria.owner_type) AND t.owner_type =$criteria.owner_type  #end
					#if($criteria.owner_id) AND t.owner_id =$criteria.owner_id  #end
				]]>
			</whereClause>			
		</operationBinding>
	</operationBindings>
</DataSource>