<DataSource
	ID="StreetsDS"
	serverType="sql"
	tableName="streets"
	qualifyColumnNames="false"
	dropExtraFields="false">
	<fields>
		<field name="streets_id"				type="integer"	title="ID"						hidden="true" 	primaryKey="true" />
		<field name="town_id"					type="integer"	title="town_id" 				hidden="true"/>
		<field name="level_I"					type="integer"	title="level_I"					hidden="true"/>
		<field name="level_II"					type="integer"	title="level_II"				hidden="true"/>
		<field name="level_III"					type="integer"	title="level_III"				hidden="true"/>
		<field name="level_IV"					type="integer"	title="level_IV"				hidden="true"/>
		<field name="level_V"					type="integer"	title="level_V"					hidden="true"/>
		<field name="type_level_I"				type="integer"	title="type_level_I"			hidden="true"/>
		<field name="type_level_II"				type="integer"	title="type_level_II"			hidden="true"/>
		<field name="type_level_III"			type="integer"	title="type_level_III"			hidden="true"/>
		<field name="type_level_IV"				type="integer"	title="type_level_IV"			hidden="true"/>
		<field name="type_level_V"				type="integer"	title="type_level_V"			hidden="true"/>
		<field name="rec_kind"					type="integer"	title="rec_kind"				hidden="true"/>		
		<field name="street_location"			type="text" 	title="street_location"/>
		<field name="street_name"				type="text" 	title="Street Name"/>
		<field name="town_name"					type="text"		title="City Name"/>
		<field name="town_district_name"		type="text"		title="town_district_name"/>			
		<field name="street_remark"				type="text" 	title="street_remark"			hidden="true"/>
		<field name="is_visible"				type="integer"	title="is_visible"				hidden="true"/>		
		<field name="loggedUserName"			type="text"		title="Logged UserName" 		hidden="true" />
		<field name="town_district_id"			type="text"		title="City Region ID" 			hidden="true" />	
		<field name="street_old_name_descr"		type="text"		title="street_old_name_descr"/>
		<field name="street_index"				type="text"		title="street_index"		/>
		<field name="street_to_town_district"	type="text"		title="street_to_town_district"/>
		<field name="hide_for_call_center"		type="integer"	title="hide_for_call_center"/>
		<field name="hide_for_correction"		type="integer"	title="hide_for_correction"/>	
		<field name="hist_start_date"			type="date"		title="hist_start_date"/>
		<field name="hist_end_date"				type="date"		title="hist_end_date"/>
		<field name="start_rcn"					type="integer"	title="start_rcn"/>
		<field name="end_rcn"					type="integer"	title="end_rcn"/>
		<field name="on_user"					type="text"		title="on_user"		/>
		<field name="off_user"					type="text"		title="off_user"/>
		
	</fields>
	
	<operationBindings>		

		<serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.CommonDMI"/>

		<!-- Add Street -->
		<operationBinding operationType="add" operationId="addStreet" serverMethod="addStreet">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.CommonDMI"/>
        </operationBinding>
        
		<!-- Street Update -->
		<operationBinding operationType="update" operationId="updateStreet" serverMethod="updateStreet">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.CommonDMI"/>
        </operationBinding>
        
        <!-- Street Status Update -->
		<operationBinding operationType="remove" operationId="deleteStreet" serverMethod="deleteStreet">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.CommonDMI"/>
        </operationBinding>
	
		<!-- Fetching Streets - Cached  -->
		<operationBinding operationId="fetchStreetEnts" operationType="fetch" serverMethod="fetchStreetEnts">
    		<serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.CommonDMI"/>
    	</operationBinding>    	
    	
    	<operationBinding operationId="fetchStreetsFromDB" operationType="fetch">
    		<selectClause>   			
    			t.streets_id,
				t.town_id,
				t.level_I,
				t.level_II,   
				t.level_III,
				t.level_IV,
				t.level_V,
				t.type_level_I,
				t.type_level_II,
				t.type_level_III,
				t.type_level_IV,
				t.type_level_V,
				t.rec_kind,
				t.street_location, 
				t.street_name,
				t.street_remark,
				t.is_visible,
				sr.town_district_name,
				c.town_name,
				get_street_old_names(t.streets_id) as street_old_name_descr,
				t.hide_for_call_center,
				t.hide_for_correction								
			</selectClause> 
			<tableClause>streets t,towns c,street_to_town_districts sd,town_district sr</tableClause>
			<whereClause><![CDATA[ 
				 t.town_id = c.town_id and
				 t.streets_id = sd.street_id(+) and
				 sd.town_district_id = sr.town_district_id(+)
				 #if($criteria.town_id) AND t.town_id = $criteria.town_id #end
				 #if($criteria.town_district_id) AND sd.town_district_id = $criteria.town_district_id #end
				 #if($criteria.rec_kind) AND t.rec_kind = $criteria.rec_kind #end
				 #if($criteria.street_name) AND t.street_name like '%'||($criteria.street_name)||'%' #end
				 
				  #if($criteria.street_location1) 
				 	AND (t.street_location like '%'||$criteria.street_location1||'%') 
				 #end
				 #if($criteria.street_location2) 
				 	AND (t.street_location like '%'||$criteria.street_location2||'%') 
				 #end
				 #if($criteria.street_location3) 
				 	AND (t.street_location like '%'||$criteria.street_location3||'%') 
				 #end
				 #if($criteria.street_location4) 
				 	AND (t.street_location like '%'||$criteria.street_location4||'%') 
				 #end
				 #if($criteria.street_location5) 
				 	AND (t.street_location like '%'||$criteria.street_location5||'%') 
				 #end
				 #if($criteria.street_index) AND t.street_index like '%'||($criteria.street_index)||'%' #end
				]]>  
			</whereClause>
			<orderClause>t.street_name</orderClause>
    	</operationBinding>

    	<operationBinding operationId="searchStreetFromDBForCombos" operationType="fetch" >
    		<selectClause>   			
    			t.streets_id,
    			t.town_id,
    			t.street_location,
				t.street_name,
				t.hide_for_call_center,
				t.hide_for_correction,
				(select min(town_district_id)
			          from street_to_town_districts sd
			         where sd.street_id = t.streets_id) town_district_id
			   #if($criteria.need_indexes) 
			   		, getStreetIndexIds(t.streets_id) as street_index 
			   #end
			</selectClause> 
			<tableClause>streets t</tableClause>
			<whereClause><![CDATA[ 
				1=1 and t.hide_for_correction = 0
				#if($criteria.street_id) AND t.streets_id = $criteria.street_id #end
				#if($criteria.town_id) AND t.town_id = $criteria.town_id #end
				#if($criteria.street_name) AND t.street_name like ($criteria.street_name)||'%' #end
				]]>  
			</whereClause> 
    	</operationBinding>    	
    	
    	
    	<operationBinding operationId="searchStreetFromDBForCombosNoDistr" operationType="fetch">
    		<selectClause>   			
    			t.streets_id,
    			t.street_name				
			</selectClause> 
			<tableClause>streets t</tableClause>
			<whereClause><![CDATA[ 
				($defaultWhereClause)  and t.hide_for_correction = 0
				]]>  
			</whereClause>
			<orderClause>t.street_name</orderClause> 
    	</operationBinding>
    	
    	<operationBinding operationId="searchStreetFromDBForCombosNoDistrTbil" operationType="fetch">
    		<selectClause>   			
    			t.streets_id,
    			t.street_name				
			</selectClause> 
			<tableClause>streets t</tableClause>
			<whereClause><![CDATA[ 
				($defaultWhereClause) and t.hide_for_correction = 0
				]]>  
			</whereClause>
			<orderClause>t.street_name</orderClause> 
    	</operationBinding>
    	
    	
    	
    	<operationBinding operationId="searchStreetForCallCenter" operationType="fetch">
    		<selectClause>
    			   /*+ index (t STR_IND_KS001)*/   			
    			   t.streets_id,
			       t.street_name,
			       t.street_location,
			       t.town_id,
			       t.street_old_name_descr,
			       t.street_index,
			       t.street_to_town_district,
			       t.hide_for_call_center,
			       t.hide_for_correction,
			       c.town_name		
			</selectClause> 
			<tableClause>streets_view t, towns c </tableClause>
			<whereClause><![CDATA[ 
				 c.town_id = t.town_id and t.hide_for_call_center = 0
				 #if($criteria.town_id) AND t.town_id = $criteria.town_id #end
				 #if($criteria.town_district_id) 
				 	AND getDistrictid(t.streets_id) like '%' || ($criteria.town_district_id)||'%'				 	 
				 #end
				 #if($criteria.street_index) AND t.street_index like '%' || ($criteria.street_index)||'%' #end
				 #if($criteria.street_name1) 
				 	AND (t.street_name like '%'||$criteria.street_name1||'%' OR t.street_old_name_descr like '%'||$criteria.street_name1||'%') 
				 #end
				 #if($criteria.street_name2) 
				 	AND (t.street_name like '%'||$criteria.street_name2||'%' OR t.street_old_name_descr like '%'||$criteria.street_name2||'%') 
				 #end
				 #if($criteria.street_name3) 
				 	AND (t.street_name like '%'||$criteria.street_name3||'%' OR t.street_old_name_descr like '%'||$criteria.street_name3||'%') 
				 #end
				 #if($criteria.street_name4) 
				 	AND (t.street_name like '%'||$criteria.street_name4||'%' OR t.street_old_name_descr like '%'||$criteria.street_name4||'%') 
				 #end
				 #if($criteria.street_name5) 
				 	AND (t.street_name like '%'||$criteria.street_name5||'%' OR t.street_old_name_descr like '%'||$criteria.street_name5||'%') 
				 #end
				 #if($criteria.street_index) AND t.street_index like '%'||($criteria.street_index)||'%' #end
				 
				 #if($criteria.street_location1) 
				 	AND (t.street_location like '%'||$criteria.street_location1||'%') 
				 #end
				 #if($criteria.street_location2) 
				 	AND (t.street_location like '%'||$criteria.street_location2||'%') 
				 #end
				 #if($criteria.street_location3) 
				 	AND (t.street_location like '%'||$criteria.street_location3||'%') 
				 #end
				 #if($criteria.street_location4) 
				 	AND (t.street_location like '%'||$criteria.street_location4||'%') 
				 #end
				 #if($criteria.street_location5) 
				 	AND (t.street_location like '%'||$criteria.street_location5||'%') 
				 #end				 
				]]>  
			</whereClause>
			<groupClause>c.town_name, t.streets_id, t.street_name, t.street_location, t.town_id, t.street_old_name_descr, t.hide_for_call_center,t.hide_for_correction</groupClause>
			<orderClause>t.town_id, t.street_name</orderClause> 
    	</operationBinding>
    	
    	
    	
    	<operationBinding operationId="histSearch" operationType="fetch">
			<selectClause>
				    t.town_id,
					t.streets_id,
					t.street_name,
					t.street_remark,
					t.street_location,
					t.is_visible,
					t.rec_kind,
					t.level_i,
					t.level_ii,
					t.level_iii,
					t.level_iv,
					t.level_v,
					t.type_level_i,
					t.type_level_ii,
					t.type_level_iii,
					t.type_level_iv,
					t.type_level_v,
					t.hide_for_call_center,
					t.hide_for_correction,
					t.hist_start_date,
					t.hist_end_date,
					t.start_rcn,
					t.end_rcn,
					t.on_user,
					t.off_user
			</selectClause>
			<tableClause>
			  	   hist_streets t
       		</tableClause>
			<whereClause><![CDATA[ 
				   	1 = 1
				   	#if($criteria.streets_id) AND t.streets_id = $criteria.streets_id #end
				   	]]>
			</whereClause>	
			<orderClause>t.start_rcn desc</orderClause>
		</operationBinding>
    	
    	
    </operationBindings>	
</DataSource>