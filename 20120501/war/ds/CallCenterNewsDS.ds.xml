<DataSource
	ID="CallCenterNewsDS"
	serverType="sql"
	tableName="call_center_news"
	qualifyColumnNames="false"
	dropExtraFields = "false">
	
	<fields>
		<field name="call_center_news_id"			type="integer"		title="call_center_news_id"			hidden="true" primaryKey="true" />
		<field name="call_center_news_text"			type="text"			title="call_center_news_text"/>
		<field name="call_center_news_date"			type="datetime"		title="call_center_news_date"/>
		<field name="call_center_warning"			type="integer"		title="call_center_warning"/>
		<field name="news_status"					type="integer"		title="news_status" 				hidden="true"/>
		<field name="loggedUserName"				type="text"			title="Logged UserName" 			hidden="true" />
		<field name="call_center_news_date_day"		type="text"			title="call_center_news_date_day"	hidden="true"/>
		<field name="call_center_news_date_time"	type="text"			title="call_center_news_date_time"	hidden="true"/>
		<field name="unread_news_cnt"				type="integer"		title="unread_news_cnt" 			hidden="true"/>
	</fields>

	<operationBindings>		
	
		<!-- Add CallCenterNews -->
		<operationBinding operationType="add" operationId="addCallCenterNews" serverMethod="addCallCenterNews">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.CallCenterNewsDMI"/>
        </operationBinding>

		<!-- CallCenterNews Update -->
		<operationBinding operationType="update" operationId="updateCallCenterNews" serverMethod="updateCallCenterNews">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.CallCenterNewsDMI"/>
        </operationBinding>

        <!-- CallCenterNews Delete -->
		<operationBinding operationType="remove" operationId="removeCallCenterNews" serverMethod="removeCallCenterNews">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.CallCenterNewsDMI"/>
        </operationBinding>

    	<operationBinding operationId="searchAllCallCenterNews" operationType="fetch">
    		<selectClause><![CDATA[   			
    				t.call_center_news_id,
					t.call_center_news_text,
					t.call_center_news_date,
					t.call_center_warning,
					to_char(t.call_center_news_date, 'dd/mm/yy') as call_center_news_date_day,
       				to_char(t.call_center_news_date, 'HH24:mi:ss') as call_center_news_date_time
       				#if($criteria.user_id)
       				 ,
			          (
			           case when t.call_center_news_id < 2514002 
			               then 1 
			               else (
			                      select decode(count(1),0,0,1) from ccare.user_cc_news_status tt where tt.news_id = t.call_center_news_id and tt.user_id = $criteria.user_id
			                    )
			           end
			          ) as news_status
       				#end       				
		     ]]></selectClause> 
			<tableClause>call_center_news t</tableClause>
			<whereClause><![CDATA[
				1 = 1
				#if($criteria.call_center_news_id) and t.call_center_news_id = $criteria.call_center_news_id #end
				#if($criteria.call_center_news_text) and t.call_center_news_text like '%'||($criteria.call_center_news_text)||'%' #end
				#if($criteria.call_center_news_text1) and t.call_center_news_text like '%'||($criteria.call_center_news_text1)||'%' #end
				#if($criteria.call_center_news_text2) and t.call_center_news_text like '%'||($criteria.call_center_news_text2)||'%' #end
				#if($criteria.call_center_news_text3) and t.call_center_news_text like '%'||($criteria.call_center_news_text3)||'%' #end
				#if($criteria.call_center_news_text4) and t.call_center_news_text like '%'||($criteria.call_center_news_text4)||'%' #end
				#if($criteria.call_center_news_text5) and t.call_center_news_text like '%'||($criteria.call_center_news_text5)||'%' #end
				#if($criteria.call_center_news_text6) and t.call_center_news_text like '%'||($criteria.call_center_news_text6)||'%' #end
				#if($criteria.call_center_news_text7) and t.call_center_news_text like '%'||($criteria.call_center_news_text7)||'%' #end
				#if($criteria.call_center_news_text8) and t.call_center_news_text like '%'||($criteria.call_center_news_text8)||'%' #end
				#if($criteria.call_center_news_text9) and t.call_center_news_text like '%'||($criteria.call_center_news_text9)||'%' #end
				#if($criteria.call_center_news_text10) and t.call_center_news_text like '%'||($criteria.call_center_news_text10)||'%' #end
				#if($criteria.call_center_news_date) and trunc(t.call_center_news_date)=trunc($criteria.call_center_news_date) #end
				#if($criteria.call_center_news_date_from) and trunc(t.call_center_news_date) >= trunc($criteria.call_center_news_date_from) #end
				#if($criteria.call_center_news_date_to) and trunc(t.call_center_news_date) <= trunc($criteria.call_center_news_date_to) #end
				#if($criteria.call_center_warning && $criteria.call_center_warning != -1) and t.call_center_warning = $criteria.call_center_warning #end
				
				]]>  
			</whereClause> 
			<orderClause>t.call_center_news_date desc</orderClause>
    	</operationBinding>
    	
    	
    	<operationBinding operationId="searchCallCenterWarnings" operationType="fetch">
    		<selectClause>   			
    				t.call_center_news_text
			</selectClause> 
			<tableClause>call_center_news t</tableClause>
			<whereClause><![CDATA[
				t.call_center_warning=1				
				]]>  
			</whereClause>
    	</operationBinding>
    	
    	
    	<operationBinding operationId="updateUsrCCNews" operationType="add">
            <customSQL>
            	 <![CDATA[
            	 	insert into user_cc_news_status (id,user_id,news_id) values (SEQ_USR_CC_NEWS_ID.nextval, $values.user_id, $values.call_center_news_id)
            	 ]]>
            </customSQL> 
        </operationBinding>
    	
    	
    	<operationBinding operationId="getUsrCCNewsCnt" operationType="fetch">
            <customSQL>
            	 <![CDATA[
            	 	select count(1) as unread_news_cnt from ccare.call_center_news t
							where t.call_center_news_id >= 2514002 and not exists (
							  select 1 from ccare.user_cc_news_status tt where tt.news_id = t.call_center_news_id and tt.user_id = $criteria.user_id
				     )
            	 ]]>
            </customSQL> 
        </operationBinding>
    	
    </operationBindings>	
</DataSource>