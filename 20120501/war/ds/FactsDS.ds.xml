<DataSource
	ID="FactsDS"
	serverType="sql"
	tableName="facts"
	qualifyColumnNames="false"
	dropExtraFields = "false">
	<fields>
		<field name="fact_id"					type="integer"		title="ID"							hidden="true" primaryKey="true" />
		<field name="fact_type_name"			type="text"			title="fact_type_name"/>
		<field name="fact_status_name"			type="text"			title="fact_status_name"/>
		<field name="remark"					type="text"			title="remark"/>
		<field name="fact_date"					type="datetime"		title="fact_date"/>
		<field name="additional_comment"		type="text"			title="additional_comment"/>
		<field name="sunup"						type="text"			title="sunup"/>
		<field name="fact_type_id"				type="integer"		title="fact_type_id"				hidden="true"/>
		<field name="fact_status_id"			type="integer"		title="fact_status_id"				hidden="true"/>
		<field name="loggedUserName"			type="text"			title="Logged UserName" 			hidden="true"/>	
		<field name="ffact_date"				type="text"			title="ffact_date" hidden="true"/>
		<field name="facts_descriptor_id"		type="integer" 		title="facts_descriptor_id"			hidden="true"/>		
		<field name="priority"					type="integer" 		title="priority" 					hidden="true"/>
	</fields>

	<operationBindings>		

		<serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.MiscDMI"/>

		<!-- Add SecularCalendar -->
		<operationBinding operationType="add" operationId="addFact" serverMethod="addFact">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.MiscDMI"/>
        </operationBinding>
        
		<!-- SecularCalendar Update -->
		<operationBinding operationType="update" operationId="updateFact" serverMethod="updateFact">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.MiscDMI"/>
        </operationBinding>
        
        <!-- SecularCalendar Status Update -->
		<operationBinding operationType="remove" operationId="removeFacts" serverMethod="removeFacts">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.MiscDMI"/>
        </operationBinding>
	
    	<operationBinding operationId="searchAllFacts" operationType="fetch">
    		<selectClause>   			
    			t.fact_id,
				t.remark,
				t.fact_date,
				t.additional_comment,
				t.fact_type_id,
				t.fact_status_id,
				t.sunup,
				ce.fact_type_name,
				cs.fact_status_name,
				to_char(t.fact_date,'DD/MM/YYYY') as ffact_date,
				ce.facts_descriptor_id,
				t.priority
			</selectClause> 
			<tableClause>facts t, v_facts_type ce, v_FACTS_STATUSES cs</tableClause>
			<whereClause><![CDATA[
				t.fact_type_id = ce.fact_type_id(+) and t.fact_status_id = cs.fact_status_id(+)
				#if($criteria.facts_descriptor_id) AND ce.facts_descriptor_id = $criteria.facts_descriptor_id #end
				#if($criteria.fact_status_id) AND t.fact_status_id = $criteria.fact_status_id #end
				#if($criteria.fact_type_id) AND t.fact_type_id = $criteria.fact_type_id #end
				#if($criteria.fact_date && $criteria.byMonth && $criteria.byMonth == 1) 
					 AND to_char(trunc(t.fact_date),'YYYYMM') = to_char(trunc($criteria.fact_date),'YYYYMM')
				#elseif($criteria.fact_date)
					 AND trunc(t.fact_date) = trunc($criteria.fact_date)
				#end
				#if($criteria.additional_comment) AND t.additional_comment like '%'||($criteria.additional_comment)||'%' #end						
				#if($criteria.remark) AND t.remark like '%'||($criteria.remark)||'%' #end
				#if($criteria.critRemarc)  AND t.additional_comment || ' '|| t.remark like '%'||$criteria.critRemarc ||'%' #end
				#if($criteria.critRemarc1)  AND t.additional_comment || ' '|| t.remark like '%'||$criteria.critRemarc1 ||'%' #end
				#if($criteria.critRemarc2)  AND t.additional_comment || ' '|| t.remark like '%'||$criteria.critRemarc2 ||'%' #end
				#if($criteria.critRemarc3)  AND t.additional_comment || ' '|| t.remark like '%'||$criteria.critRemarc3 ||'%' #end
				#if($criteria.critRemarc4)  AND t.additional_comment || ' '|| t.remark like '%'||$criteria.critRemarc4 ||'%' #end
				#if($criteria.critRemarc5)  AND t.additional_comment || ' '|| t.remark like '%'||$criteria.critRemarc5 ||'%' #end
				#if($criteria.critRemarc6)  AND t.additional_comment || ' '|| t.remark like '%'||$criteria.critRemarc6 ||'%' #end
				#if($criteria.critRemarc7)  AND t.additional_comment || ' '|| t.remark like '%'||$criteria.critRemarc7 ||'%' #end
				#if($criteria.critRemarc8)  AND t.additional_comment || ' '|| t.remark like '%'||$criteria.critRemarc8 ||'%' #end
				#if($criteria.critRemarc9)  AND t.additional_comment || ' '|| t.remark like '%'||$criteria.critRemarc9 ||'%' #end
				#if($criteria.critRemarc10)  AND t.additional_comment || ' '|| t.remark like '%'||$criteria.critRemarc10 ||'%' #end
				]]>  
			</whereClause> 
			<orderClause>t.fact_date asc, t.priority desc</orderClause>
    	</operationBinding>
    </operationBindings>	
</DataSource>