<DataSource
    ID="LogSessChDS"
    serverType="sql"
    tableName="call_session_expense"      
    qualifyColumnNames="false"
    >
    <fields>
    	<field name="cse_id"				type="integer" 	title="cse_id" 				hidden="true"		primaryKey="true" />
    	<field name="session_id" 			type="text" 	title="session_id"  		hidden="true"/>
        <field name="year_month"			type="integer" 	title="year_month"			hidden="true"/>
        <field name="service_id"  			type="integer"  title="service_id"			hidden="true"/>        
        <field name="service_description"	type="text"  	title="service_description"/>
        <field name="charge"  				type="integer"  title="charge"/>
        <field name="organization_name"		type="text"  	title="organization_name"/>
        <field name="charge_date"			type="date" 	title="charge_date"/>
        <field name="amount"  				type="float"  	title="amount"/>
        <field name="aprice"  				type="float"  	title="aprice"/>
        <field name="cnt"  					type="float"  	title="cnt"/>
        <field name="organization_id"  		type="integer"  title="organization_id"/>
        <field name="call_phone"  			type="text"  	title="call_phone"/>
        <field name="event_describtion"		type="text"  	title="event_describtion"/>
    </fields>
    
    <!-- Add Log Session Charge -->
	<operationBinding operationType="add" operationId="addLogSessionCharge" serverMethod="addLogSessionCharge">
    	<serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.MiscDMI"/>
    </operationBinding>
    
     <operationBindings>
    	<operationBinding operationId="custSessCharges" operationType="fetch">
    		<selectClause>   			
    			ch.session_id,	
				s.service_description,
				ch.charge,
				o.org_name
			</selectClause> 
			<tableClause>log_session_charges ch, services s, main_orgs o</tableClause>
			<whereClause><![CDATA[ 
				ch.service_id = s.service_id(+) and
				h.organization_id = o.organization_id(+) and				
				ch.session_id=$criteria.sessionId and
				ch.deleted = 0
				]]>  
			</whereClause> 
    	</operationBinding>
    	<operationBinding operationId="custSessNavig" operationType="fetch">
    		<selectClause>   			
    			h.session_id,	
				s.service_name_geo,
				o.org_name
			</selectClause> 
			<tableClause>log_main_hits h, services s, main_orgs o</tableClause>
			<whereClause><![CDATA[ 
				h.service_id = s.service_id and				
				h.organization_id = o.organization_id(+) and				
				h.session_id=$criteria.sessionId
				]]>  
			</whereClause> 
    	</operationBinding>
    	
        <!-- Log SMS -->
		<operationBinding operationId="LogSMS" operationType="add">
            <customSQL>
            	 <![CDATA[
            	    #if($values.organization_id)
            	    	call send_sms_to_reciptent_new_org($values.sms_text,$values.phone,$values.session_id,$values.service_id, $values.organization_id, $values.rec_user)
            	    #else
            	 		call send_sms_to_reciptent_new($values.sms_text,$values.phone,$values.session_id,$values.service_id, $values.rec_user)
            	 	#end
            	 ]]>
            </customSQL> 
        </operationBinding>
        <operationBinding operationId="LogSMSNew1" operationType="add">
            <customSQL>
            	 <![CDATA[
            	 	{call SEND_SMS_TO_RECIPTENT_NEW1($values.sms_text,$values.phone,$values.session_id,$values.service_id, $values.rec_user, $values.sms_type)}            	 	
            	 ]]>
            </customSQL> 
        </operationBinding>
        
        <operationBinding operationId="LogSMSDisc" operationType="add">
            <customSQL>
            	 <![CDATA[
            	 	insert into SENT_SMS_HIST 
            	 		(SENT_SMS_HIST_ID,SESSION_CALL_ID,MESSAGE_TYPE,MESSAGE_CONTEXT,RECIEVER_NUMBER,reciever_number) 
            	 	values 
            	 		(SEQ_SENT_SMS_HIST.NEXTVAL,$values.session_id,$values.sms_type,$values.sms_text,trim($values.phone),$values.rec_user)
            	 ]]>
            </customSQL> 
        </operationBinding>
        
        <operationBinding operationId="LogMainHits" operationType="add">
            <customSQL>
            	 <![CDATA[
            	 	insert into LOG_MAIN_HITS 
            	 		(YM, SESSION_ID,  organization_id, SERVICE_ID) 
					values
                        ($values.ym, $values.session_id, $values.organization_id, $values.service_id)            		
            	 ]]>
            </customSQL> 
        </operationBinding>
        
        
        <operationBinding operationId="LogSessionEvent" operationType="add">
            <customSQL>
            	 <![CDATA[
            	 	insert into CALL_SESSION_EVENT 
            	 		(SESSION_ID,  EVENT_DESCRIPTION, SERVICE_ID,USER_NAME) 
					values
                        ($values.session_id, $values.event_describtion, $values.service_id,$values.loggedUserName)            		
            	 ]]>
            </customSQL> 
        </operationBinding>
        
    </operationBindings>
</DataSource>