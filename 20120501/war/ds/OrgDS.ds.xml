<DataSource 
	ID="OrgDS"
    serverType="sql"
    tableName="organizations"      
    qualifyColumnNames="false"
    dropExtraFields = "false">
    
	<fields>
		<field name="organization_id"				type="integer"		title="organization_id"					hidden="true" 	primaryKey="true" />
		<field name="parrent_organization_id"		type="integer"  	title="parrent_organization_id"			hidden="true"	foreignKey="OrgDS.organization_id"  detail="true"/>
		<field name="parrent_organization_id1"		type="integer"  	title="parrent_organization_id1"		hidden="true"/>
		<field name="organization_name"				type="text"  		title="organization_name"/>
		<field name="remark"						type="text"  		title="remark"/>
		<field name="ident_code"					type="text"  		title="ident_code"/>
		<field name="ident_code_new"				type="text"  		title="ident_code_new"/>
		<field name="work_hours"					type="text"  		title="work_hours"/>
		<field name="found_date"					type="datetime"  	title="found_date"/>
		<field name="email_address"					type="text"  		title="email_address"/>
		<field name="web_address"					type="text"  		title="web_address"/>
		<field name="social_address"				type="text"  		title="social_address"/>
		<field name="additional_info"				type="text"  		title="additional_info"/>
		<field name="contact_person"				type="text"  		title="contact_person"/>
		<field name="day_offs"						type="integer"  	title="day_offs"/>
		<field name="day_offs_descr"				type="text"  		title="day_offs_descr"/>
		<field name="staff_count"					type="integer"  	title="staff_count"/>
		<field name="organization_index"			type="text"  		title="organization_index"/>
		<field name="organization_name_eng"			type="text"  		title="organization_name_eng"/>
		<field name="real_address_descr"			type="text"  		title="real_address_descr"/>
		<field name="legal_address_descr"			type="text"  		title="legal_address_descr"/>
		<field name="full_address_not_hidden"		type="text"  		title="full_address_not_hidden"/>
		<field name="legal_form_desc_id"			type="integer"  	title="legal_form_desc_id"				hidden="true"/>
		<field name="status"						type="integer"  	title="status"							hidden="true"/>		
		<field name="important_remark"				type="integer"  	title="important_remark"				hidden="true"/>		
		<field name="town_name"						type="text"  		title="town_name"/>
		<field name="town_district_name"			type="text"  		title="town_district_name"/>	
		<field name="street_location"				type="text"  		title="street_location"/>
		<field name="street_index_text"				type="text"  		title="street_index_text"/>		
		<field name="legal_form_desc"				type="text"  		title="legal_form_desc"/>		
		<field name="town_id"						type="integer"  	title="town_id"							hidden="true"/>		
		<field name="priority"						type="integer"  	title="priority"						hidden="true"/>
		<field name="super_priority"				type="integer"  	title="super_priority"					hidden="true"/>		
		<field name="street_name"					type="text"  		title="street_name"/>
		<field name="phone_number"					type="text"  		title="phone_number"/>		
		<field name="org_or_abon_type"				type="integer"  	title="org_or_abon_type"				hidden="true"/>
		<field name="hide"							type="integer"  	title="hide"							hidden="true"/>
		<field name="org_or_abon"					type="text"  		title="org_or_abon"/>
		<field name="phoneStatusID"					type="integer"  	title="phoneStatusID"					hidden="true"/>
		<field name="street_old_name"				type="text"  		title="street_old_name"/>
		<field name="address_hide"					type="integer"  	title="address_hide"					hidden="true"/>		
		<field name="contact_phones"				type="integer"  	title="contact_phones"					hidden="true"/>
		<field name="phone_status"					type="text"  		title="phone_status"/>
		<field name="organization_name_tree"		type="text"  		title="organization_name_tree"/>
		<field name="is_abonent"					type="integer"  	title="is_abonent"						hidden="true"/>
		<field name="town_district_id"				type="integer"  	title="town_district_id"				hidden="true"/>
		<field name="street_id"						type="integer"  	title="street_id"						hidden="true"/>
		<field name="legal_address_id"				type="integer"  	title="legal_address_id"				hidden="true"/>
		<field name="physical_address_id"			type="integer"  	title="physical_address_id"				hidden="true"/>
		<field name="hidden_by_request"				type="integer"  	title="hidden_by_request"				hidden="true"/>
		<field name="tree_org_parrent"				type="text"  		title="tree_org_parrent"/>
		<field name="tree_org_child"				type="text"  		title="tree_org_child"/>
		<field name="full_address"					type="text"  		title="full_address"/>
		<field name="block"							type="text"  		title="block"/>
		<field name="appt"							type="text"  		title="appt"/>
		<field name="descr"							type="text"  		title="descr"/>
		<field name="anumber"						type="text"  		title="anumber"/>
		<field name="street_indexes"				type="text"  		title="street_indexes"/>
		<field name="org_allert_by_buss_det"		type="text"  		title="org_allert_by_buss_det"/>
		<field name="chief"							type="text"  		title="chief"/>
		<field name="legal_addr_town_id"			type="integer"  	title="legal_addr_town_id"				hidden="true"/>
		<field name="legal_addr_street_id"			type="integer"  	title="legal_addr_street_id"			hidden="true"/>
		<field name="legal_addr_town_district_id"	type="integer"  	title="legal_addr_town_district_id"		hidden="true"/>
		<field name="legal_addr_hidden_by_request"	type="integer"  	title="legal_addr_hidden_by_request"	hidden="true"/>
		<field name="legal_addr_full_address"		type="text"  		title="legal_addr_full_address"			hidden="true"/>
		<field name="legal_addr_block"				type="text"  		title="legal_addr_block"				hidden="true"/>
		<field name="legal_addr_appt"				type="text"  		title="legal_addr_appt"					hidden="true"/>
		<field name="legal_addr_anumber"			type="text"  		title="legal_addr_anumber"				hidden="true"/>
		<field name="legal_addr_street_location"	type="text"  		title="legal_addr_street_location"		hidden="true"/>
		<field name="legal_addr_street_index_text"	type="text"  		title="legal_addr_street_index_text"	hidden="true"/>
		<field name="orgActivities"					type="any"  		title="orgActivities"					hidden="true"/>
		<field name="orgPartnerBanks"				type="any"  		title="orgPartnerBanks"					hidden="true"/>
		<field name="physicalAddrValues"			type="any"  		title="physicalAddrValues"				hidden="true"/>
		<field name="legalAddrValues"				type="any"  		title="legalAddrValues"					hidden="true"/>
		<field name="partBankUpdated"				type="integer"  	title="partBankUpdated"					hidden="true"/>
		<field name="ph_town_id"					type="integer"  	title="ph_town_id"						hidden="true"/>
		<field name="original_org_name"				type="text"  		title="original_org_name"				hidden="true"/>
		<field name="mainIdList"					type="any"  		title="mainIdList"						hidden="true"/>
		<field name="recCount" 						type="integer" 		title="recCount" 						hidden="true" />
		<field name="hist_start_date"   			type="datetime" 	title="hs_hist_start_date"/>
		<field name="hist_end_date"   				type="datetime" 	title="hs_hist_end_date"/>
		<field name="on_user"  						type="text"  		title="hs_on_user"/>
		<field name="off_user"		   				type="text"  		title="hs_off_user"/>
		<field name="off_user"		   				type="text"  		title="hs_off_user"/>
		<field name="rdeleted"   					type="boolean"  	title="hph_rcn" 			sqlStorageStrategy="integer"/>
		<field name="parrent_organization"			type="text"  		title="parrent_organization"/>
		<field name="cust_order"					type="integer"  	title="cust_order"/>
	</fields>
	<operationBindings>
	
	
		<!-- Add New Organization -->
		<operationBinding operationType="add" operationId="addOrganization" serverMethod="addOrUpdateOrganization">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.OrganizationDMI"/>
        </operationBinding>
        <operationBinding operationType="update" operationId="updateOrganization" serverMethod="addOrUpdateOrganization">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.OrganizationDMI"/>
        </operationBinding>
	
		 <!-- Sort Order -->
		<operationBinding operationType="update" operationId="updateOrgSortOrder" serverMethod="updateOrgSortOrder">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.OrganizationDMI"/>
        </operationBinding>
        
		<!-- Remove Organization -->
		<operationBinding operationType="remove" operationId="removeOrganization" serverMethod="removeOrganization">
			<serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.OrganizationDMI"/>            
        </operationBinding>
		
		 <!-- FETCH -->
        <operationBinding operationId="searchOrgReversed" operationType="fetch">
            <customSQL>
            	 <![CDATA[
            	 select *
				 from (select level m_level, t.*
				          from organizations t
				         start with t.organization_id = $criteria.organization_id
				        connect by prior t.organization_id = t.parrent_organization_id
				         order siblings by nvl(t.parrent_organization_id,0),t.priority) k
				 order by k.m_level desc
            	 ]]>
            </customSQL> 
        </operationBinding>
		
		
		<!-- FETCH -->
        <operationBinding operationId="orgCheckParrChild" operationType="fetch">
            <customSQL>
            	 <![CDATA[
            	  select 
            	  		count(1) as recCount
				  from (select level as my_level, t.*
				          from organizations t
				         start with t.organization_id = $criteria.curr_organization_id
				        connect by prior t.organization_id = t.parrent_organization_id) tt
				  where tt.my_level > 1
				   and tt.organization_id = $criteria.parr_organization_id
            	 ]]>
            </customSQL> 
        </operationBinding>
		
		<!-- FETCH -->
		<operationBinding operationId="customOrgSearchForCallCenterNew" operationType="fetch">			
			<selectClause><![CDATA[
						o.organization_id,
						o.parrent_organization_id,
						o.parrent_organization_id as parrent_organization_id1,
						#if($criteria.pp_organization_id)
							hr.my_rownum,
							lpad(' ', (hr.mylevel - 1) * 4, '.') || o.organization_name 
						#else
							o.organization_name 
						#end
						as organization_name,
						o.organization_name as original_org_name,
						a.concat_address as full_address_not_hidden,
						decode(o.parrent_organization_id,null,null,'home') as tree_org_parrent,
		                decode((select min(1) from organizations ms1 where ms1.parrent_organization_id = o.organization_id),null,null,'associations') as tree_org_child,
						a.town_id,
						o.priority,
             			o.super_priority,
						o.ident_code,
						o.ident_code_new,
						o.chief,
						o.remark,
						o.work_hours,
						o.found_date,
						o.email_address,
						o.additional_info,
						o.web_address,
						o.contact_person,
						o.day_offs,
						getdaysdescription(o.day_offs) as day_offs_descr,
						o.staff_count,
						o.organization_index,
						o.organization_name_eng,						
						o.legal_form_desc_id,
						getdaysdescription(o.legal_form_desc_id) as legal_form_desc,
						o.status,
						a.street_id,
						a.town_name,
						a.town_district_name as town_district,
						a.street_location,
						a.street_index_text,
						o.important_remark,						
             			a.town_district_id,
             		    getTbilisiOrder(a.town_id) as cust_order,
		                a.street_name,
		                a.hidden_by_request,		                
		                a.full_address,
						a.block,
						a.appt,
						a.descr,
						a.anumber,
						o.super_priority,						
						getorgbusiness_alerts(o.organization_id) as org_allert_by_buss_det,
						o.legal_address_id,
						o.physical_address_id,
						o.social_address,
						a1.town_id as legal_addr_town_id,
						a1.street_id as legal_addr_street_id,
						a1.town_district_id as legal_addr_town_district_id,
						a1.hidden_by_request as legal_addr_hidden_by_request,
						o.old_legal_address as legal_addr_full_address,
						a1.block as legal_addr_block,
						a1.appt as legal_addr_appt,
						a1.anumber as legal_addr_anumber,
						a1.street_location as legal_addr_street_location,
						a1.street_index_text as legal_addr_street_index_text,
						a1.descr						
				 ]]>
			</selectClause>
			<tableClause>organizations o,
				#if($criteria.pp_organization_id)(
							select t.organization_id, level mylevel, rownum as my_rownum
			  from organizations t
			 start with t.organization_id =(select tt.organization_id
								            from (select t.organization_id, t.parrent_organization_id
								                    from organizations t
								                   start with t.organization_id = $criteria.pp_organization_id
								                  connect by prior t.parrent_organization_id = t.organization_id) tt
								           where tt.parrent_organization_id is null)
			connect by prior t.organization_id = t.parrent_organization_id
			order siblings by getTbilisiOrder(t.ph_town_id), t.super_priority, nvl(t.parrent_organization_id,0), t.priority
			) hr, #end
				v_full_address a, v_full_address a1</tableClause>
			<whereClause>
				 <![CDATA[
						 o.physical_address_id = a.addr_id(+) and 
						 o.legal_address_id = a1.addr_id(+) 
						 
							#if($criteria.organization_name) 
								#foreach($str in $criteria.organization_name.split(" "))
									and o.organization_name like '%'||'$str'||'%'
								#end
							#end
						 	#if($criteria.organization_name_param) 
								#foreach($str in $criteria.organization_name_param.split(" "))
									and o.organization_name like '%'||'$str'||'%'
								#end
							#end
						 	
						 	#if($criteria.full_address_not_hidden) 
								#foreach($str in $criteria.full_address_not_hidden.split(" "))
									and (tw.town_name||' / '|| getDistrict(str.street_id)||' / '||str.street_name||' '||a.full_address) like '%'||'$str'||'%'
								#end
							#end
						 	
						 #if($criteria.phone)
						 	and o.organization_id in (
						 		select 
						 			distinct od.organization_id
						  		from ccare.organization_department od
						 		where od.org_department_id in
						       		  (select 
						       		  		  distinct dp.org_department_id
						          	   from organization_depart_to_phones dp
						         	   where dp.phone_number_id in
						               		(select 
						               				t.phone_number_id
						                  	 from phone_numbers t
						                 	 where t.phone = $criteria.phone
						                 	)
						              ) 
						       )
						 #end
						 
						 #if($criteria.department)
						 	and o.organization_id in (
						 		select od.organization_id from organization_department od
						 		where 1 = 1
						 		#foreach($str in $criteria.department.split(" "))
									and od.department like '%'||'$str'||'%'
								#end
						 	)						 	
						 #end
						 
						 #if($criteria.pp_organization_id)
						 	and hr.organization_id=o.organization_id
						 #else
							 #if($criteria.parrent_organization_id) and o.parrent_organization_id = $criteria.parrent_organization_id #end
							 #if($criteria.organization_id) and o.organization_id = $criteria.organization_id #end
							 #if($criteria.pp_organization_id) and o.organization_id = $criteria.pp_organization_id #end
							 #if($criteria.remark1) and o.remark like '%'||($criteria.remark1)||'%' #end
							 #if($criteria.remark2) and o.remark like '%'||($criteria.remark2)||'%' #end
							 #if($criteria.remark3) and o.remark like '%'||($criteria.remark3)||'%' #end
							 #if($criteria.remark4) and o.remark like '%'||($criteria.remark4)||'%' #end
							 #if($criteria.remark5) and o.remark like '%'||($criteria.remark5)||'%' #end
							 #if($criteria.remark6) and o.remark like '%'||($criteria.remark6)||'%' #end
							 #if($criteria.remark7) and o.remark like '%'||($criteria.remark7)||'%' #end
							 #if($criteria.remark8) and o.remark like '%'||($criteria.remark8)||'%' #end
							 #if($criteria.remark9) and o.remark like '%'||($criteria.remark9)||'%' #end
							 #if($criteria.remark10) and o.remark like '%'||($criteria.remark)||'%' #end
							 #if($criteria.real_address_descr1) and a.concat_address like '%'||($criteria.real_address_descr1)||'%' #end
							 #if($criteria.real_address_descr2) and a.concat_address like '%'||($criteria.real_address_descr2)||'%' #end
							 #if($criteria.real_address_descr3) and a.concat_address like '%'||($criteria.real_address_descr3)||'%' #end
							 #if($criteria.real_address_descr4) and a.concat_address like '%'||($criteria.real_address_descr4)||'%' #end
							 #if($criteria.real_address_descr5) and a.concat_address like '%'||($criteria.real_address_descr5)||'%' #end
							 #if($criteria.legaladdress) and o.legaladdress like '%'||($criteria.legaladdress)||'%' #end
							 #if($criteria.legaladdress1) and o.legaladdress like '%'||($criteria.legaladdress1)||'%' #end
							 #if($criteria.legaladdress2) and o.legaladdress like '%'||($criteria.legaladdress2)||'%' #end
							 #if($criteria.legaladdress3) and o.legaladdress like '%'||($criteria.legaladdress3)||'%' #end
							 #if($criteria.legaladdress4) and o.legaladdress like '%'||($criteria.legaladdress4)||'%' #end
							 #if($criteria.legaladdress5) and mo1.legaladdress like '%'||($criteria.legaladdress5)||'%' #end
							 #if($criteria.chief1) and o.chief like '%'||($criteria.chief1)||'%' #end
							 #if($criteria.chief2) and o.chief like '%'||($criteria.chief2)||'%' #end
							 #if($criteria.chief3) and o.chief like '%'||($criteria.chief3)||'%' #end
							 #if($criteria.day_offs1) and getOrgDayoffs(o.day_offs) like '%'||($criteria.day_offs1)||'%' #end
							 #if($criteria.day_offs2) and getOrgDayoffs(o.day_offs) like '%'||($criteria.day_offs2)||'%' #end
							 #if($criteria.day_offs3) and getOrgDayoffs(o.day_offs) like '%'||($criteria.day_offs3)||'%' #end
							 #if($criteria.day_offs4) and getOrgDayoffs(o.day_offs) like '%'||($criteria.day_offs4)||'%' #end
							 #if($criteria.day_offs5) and getOrgDayoffs(o.day_offs) like '%'||($criteria.day_offs5)||'%' #end
							 #if($criteria.day_offs6) and getOrgDayoffs(o.day_offs) like '%'||($criteria.day_offs6)||'%' #end
							 #if($criteria.full_address) and a.full_address||' '||a.block||' '||a.appt||' '||a.descr||' '||a.anumber like '%'||($criteria.full_address)||'%' #end						 
							 #if($criteria.work_hours) and o.work_hours like '%'||($criteria.work_hours)||'%' #end
							 #if($criteria.web_address) and o.web_address like '%'||($criteria.web_address)||'%' #end
							 #if($criteria.email_address) and o.email_address like '%'||($criteria.email_address)||'%' #end
							 #if($criteria.legal_statuse_id) and o.legal_statuse_id = $criteria.legal_statuse_id #end
							 #if($criteria.ind) and o.ind = $criteria.ind #end
							 #if($criteria.street_id) and ma.street_id = $criteria.street_id #end
							 #if($criteria.town_id) and a.town_id = $criteria.town_id #end
							 #if($criteria.ident_code) and (o.ident_code = $criteria.ident_code or o.ident_code_new = $criteria.ident_code) #end
							 #if($criteria.town_district_id) and a.town_district_id = $criteria.town_district_id #end
							 #if($criteria.org_found_date_start) and trunc(o.found_date)>= trunc($criteria.org_found_date_start) and  trunc(o.found_date)<= trunc($criteria.org_found_date_end) #end
						  #end
				 ]]>
			</whereClause>
			<orderClause>
						#if($criteria.pp_organization_id)
							hr.my_rownum 
						#else
							getTbilisiOrder(a.town_id), o.super_priority, nvl(o.parrent_organization_id,0), o.priority 
						#end
				
			</orderClause>
		</operationBinding>
		
		<!-- Main Service Update On Drag And Drop -->
		<operationBinding operationId="findSupperMainOrgId" operationType="fetch">
            <customSQL>
            	 <![CDATA[
            	 	select tt.organization_id
					  from (select t.organization_id, t.parrent_organization_id
					          from organizations t
					         start with t.organization_id = $criteria.organization_id
					        connect by prior t.parrent_organization_id = t.organization_id) tt
					 where tt.parrent_organization_id is null
            	 ]]>
            </customSQL> 
        </operationBinding>
        
		<operationBinding operationId="searchMainOrgsForCB" operationType="fetch">
    		<selectClause>   			
    			mo.organization_id,
    			mo.organization_name 
			</selectClause> 
			<tableClause>ccare.main_orgs mo, ccare.main_services ms</tableClause>	
			<whereClause>
				    ms.service_id = 3 and ms.deleted = 0 and ms.organization_id = mo.organization_id and
				    ($defaultWhereClause)
			</whereClause>	
			<orderClause>mo.organization_name</orderClause>		
    	</operationBinding>
    	
    	<operationBinding operationId="searchMainOrgsForCBDoubleLike" operationType="fetch">
    		<selectClause>   			
    			o.organization_id,
    			o.organization_name,
    			o.remark,
    			(tw.town_name||' / '|| getDistrict(str.street_id)||' / '||str.street_name||' '||a.full_address) as full_address_not_hidden
			</selectClause> 
			<tableClause>organizations o, addresses a, streets str, towns tw</tableClause>	
			<whereClause>
					o.physical_address_id = a.addr_id and str.street_id = a.street_id and tw.town_id = a.town_id
				    #if($criteria.organization_id) and o.organization_id = $criteria.organization_id #end
					#if($criteria.organization_name) and o.organization_name like '%'||$criteria.organization_name||'%' #end				    
					#if($criteria.remark) and o.remark like '%'||$criteria.remark||'%' #end
					#if($criteria.full_address_not_hidden) and (tw.town_name||' / '|| getDistrict(str.street_id)||' / '||str.street_name||' '||a.full_address) like '%'||$criteria.full_address_not_hidden||'%' #end					
			</whereClause>				
    	</operationBinding>
    	
    	
    	<operationBinding operationId="searchOrgPartnerBanks" operationType="fetch">
    		<selectClause>   			
    			o.organization_id,
    			o.organization_name,
    			o.remark,
    			(tw.town_name||' / '|| getDistrict(str.street_id)||' / '||str.street_name||' '||a.full_address) as full_address_not_hidden
			</selectClause> 
			<tableClause>organization_partner_banks t,organizations o, addresses a, streets str, towns tw</tableClause>	
			<whereClause>
					t.part_bank_org_id = o.organization_id and o.physical_address_id = a.addr_id and str.street_id = a.street_id and tw.town_id = a.town_id
				    #if($criteria.organization_id) and t.organization_id = $criteria.organization_id #end
					#if($criteria.organization_name) and o.organization_name like '%'||$criteria.organization_name||'%' #end				    
					#if($criteria.remark) and o.remark like '%'||$criteria.remark||'%' #end
					#if($criteria.full_address_not_hidden) and (tw.town_name||' / '|| getDistrict(str.street_id)||' / '||str.street_name||' '||a.full_address) like '%'||$criteria.full_address_not_hidden||'%' #end					
			</whereClause>				
    	</operationBinding>
    	
    	
    	
    	<operationBinding operationId="searchPartnerBanks" operationType="fetch">
    		<selectClause>   			
    			o.organization_id,
    			o.organization_name,
    			o.remark,
    			(tw.town_name||' / '|| getDistrict(str.street_id)||' / '||str.street_name||' '||a.full_address) as full_address_not_hidden
			</selectClause> 
			<tableClause>organizations o, organization_to_activities oa, organization_activities aa, addresses a, streets str, towns tw</tableClause>	
			<whereClause>
					o.organization_id = oa.organization_id and oa.org_activity_id = aa.org_activity_id and aa.is_bank_activity = 1 and 
					o.physical_address_id = a.addr_id and str.street_id = a.street_id and tw.town_id = a.town_id
				    #if($criteria.organization_id) and o.organization_id = $criteria.organization_id #end
					#if($criteria.organization_name) and o.organization_name like '%'||$criteria.organization_name||'%' #end				    
					#if($criteria.remark) and o.remark like '%'||$criteria.remark||'%' #end
					#if($criteria.full_address_not_hidden) and (tw.town_name||' / '|| getDistrict(str.street_id)||' / '||str.street_name||' '||a.full_address) like '%'||$criteria.full_address_not_hidden||'%' #end					
			</whereClause>				
			<orderClause>gettbilisiorder(tw.town_id),o.organization_name</orderClause>	
    	</operationBinding>
    	
    	
    	<operationBinding operationId="searchOrgPartnerBanksHist" operationType="fetch">
    		<selectClause>   			
    			organization_id,
				part_bank_org_id,
				partnior_bank_name,
				hist_start_date,
				hist_end_date,
				start_rcn,
				end_rcn,
				on_user,
				off_user,
				rdeleted
			</selectClause> 
			<tableClause>hist_org_partner_banks t</tableClause>	
			<whereClause>
				    #if($criteria.organization_id) and o.organization_id = $criteria.organization_id #end
			</whereClause>				
			<orderClause>part_bank_org_id, start_rcn desc</orderClause>	
    	</operationBinding>
    	
    	
    	<operationBinding operationId="histSearch"
			operationType="fetch">			
			<selectClause>
				   organization_id,
			       parrent_organization_id,
			       parrent_organization,
			       original_org_name,
			       full_address_not_hidden,
			       tree_org_parrent,
			       town_id,
			       priority,
			       super_priority,
			       ident_code,
			       ident_code_new,
			       chief,
			       remark,
			       work_hours,
			       found_date,
			       email_address,
			       additional_info,
			       web_address,
			       contact_person,
			       day_offs,
			       day_offs_descr,
			       staff_count,
			       organization_index,
			       organization_name_eng,
			       legal_form_desc_id,
			       legal_form_desc,
			       status,
			       street_id,
			       town_name,
			       town_district,
			       street_location,
			       street_index_text,
			       important_remark,
			       town_district_id,
			       cust_order,
			       hidden_by_request,
			       block,
			       appt,
			       descr,
			       anumber,
			       org_allert_by_buss_det,
			       legal_address_id,
			       physical_address_id,
			       social_address,
			       legal_addr_town_id,
			       legal_addr_street_id,
			       legal_addr_town_district_id,
			       legal_addr_hidden_by_request,
			       legal_addr_full_address,
			       legal_addr_block,
			       legal_addr_appt,
			       legal_addr_anumber,
			       legal_addr_street_location,
			       legal_addr_street_index_text,
			       legal_addr_not_hidden,
			       hist_start_date,
			       hist_end_date,
			       start_rcn,
			       end_rcn,
			       on_user,
			       off_user,
			       rdeleted
			</selectClause>
			<tableClause>
			  	   hist_V_ORGANIZATION t
       		</tableClause>
			<whereClause><![CDATA[ 
				   	1 = 1
				   	#if($criteria.organization_id) AND t.organization_id = $criteria.organization_id #end
				   	#if($criteria.original_org_name) AND t.original_org_name like '%'||($criteria.original_org_name)||'%' #end
				   	#if($criteria.concat_address)  and t.concat_address like '%'||($criteria.concat_address)||'%' AND t.town_district not like '%'||($criteria.concat_address)||'%' #end
				   	#if($criteria.town_name) AND t.town_name like '%'||($criteria.town_name)||'%' #end
				   	#if($criteria.town_district) AND t.town_district like '%'||($criteria.town_district)||'%' #end
				   	#if($criteria.ident_code) AND $criteria.ident_code in (ident_code,ident_code_new) #end
				   	
				   	#if($criteria.phone_number)
				   	and exists (select 1
				          from  ccare.hist_phone_numbers        hph
				          	    ,ccare.HIST_ORG_DEPART_TO_PHONES htp
				          		,ccare.HIST_ORGANIZATION_DEPARTMENT hd
				         where hph.phone = ($criteria.phone_number) )
				         	and htp.phone_number_id = hph.phone_number_id
				         	and htp.ORG_DEPARTMENT_ID = hd.ORG_DEPARTMENT_ID
				         	and hd.organization_id = t.organization_id
				           
				           
				            				   	
				   	 #end
				   	]]>
			</whereClause>	
			<orderClause>t.organization_id, start_rcn desc</orderClause>
		</operationBinding>
    	
	</operationBindings>
</DataSource>