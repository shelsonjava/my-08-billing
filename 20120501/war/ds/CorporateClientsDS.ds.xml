<DataSource
	ID="CorporateClientsDS"
	serverType="sql"
	tableName="corporate_clients"
	qualifyColumnNames="false"
	dropExtraFields = "false">
	<fields>
		<field name="corporate_client_id"	type="integer"		title="ID"						hidden="true" primaryKey="true" />
		<field name="block"					type="integer"		title="block"					hidden="true"/>
		<field name="organization_id"		type="integer"		title="organization_id"			hidden="true"/>
		<field name="organization_name"		type="text"			title="organization_name"/>
		<field name="contract_start_date"	type="date"			title="contract_start_date"/>
		<field name="contract_end_date"		type="date"			title="contract_end_date"/>
		<field name="max_call_count"		type="integer"		title="max_call_count"			hidden="true"/>
		<field name="call_price"			type="any"			title="call_price"/>
		<field name="remark"				type="text"			title="remark"/>
		<field name="goverment"				type="integer"		title="goverment"				hidden="true"/>
		<field name="price_type"			type="integer"		title="price_type"				hidden="true"/>
		<field name="sms_warning"			type="integer"		title="sms_warning"				hidden="true"/>
		<field name="loggedUserName"		type="text"			title="loggedUserName"			hidden="true"/>
		<field name="contractorAdvPrices"	type="any"			title="contractorAdvPrices" 	hidden="true"/>
		<field name="contractorAdvPhones"	type="any"			title="contractorAdvPhones" 	hidden="true"/>
		<field name="block_type"			type="integer"		title="block_type"				hidden="true"/>
		<field name="contractor_call_cnt"	type="integer"		title="contractor_call_cnt"		hidden="true"/>
		<field name="phone"					type="text"			title="phone"					hidden="true"/>
		<field name="price_type_descr"		type="text"			title="price_type_descr"		hidden="true"/>
		<field name="range_curr_price"		type="any"			title="range_curr_price"		hidden="true"/>
		<field name="checkContractor"		type="integer"		title="checkContractor"			hidden="true"/>		
		<field name="call_count"			type="integer"		title="call_count"				hidden="true"/>
		<field name="amount"				type="any"			title="amount"					hidden="true"/>
		<field name="billing_company_name"	type="text"			title="billing_company_name"	hidden="true"/>
		<field name="service_description"	type="text"			title="service_name_geo"		hidden="true"/>
		<field name="call_date"				type="datetime"		title="call_date"				hidden="true"/>
		<field name="charge_date"			type="datetime"		title="charge_date"				hidden="true"/>
		<field name="limitType"				type="integer"		title="limitType"				hidden="true"/>
		<field name="contractor_type"		type="integer"		title="contractor_type"			hidden="true"/>
		<field name="ident_code"			type="text"			title="ident_code"				hidden="true"/>
		<field name="operator_src"			type="integer"		title="operator_src"			hidden="true"/>
		<field name="mail_service_price"	type="any"			title="mail_service_price"		hidden="true"/>
		<field name="charge_cnt"			type="integer"		title="charge_cnt"				hidden="true"/>
	</fields>
	<operationBindings>		

		<serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.ContractorsDMI"/>

		<!-- Add Contractor -->
		<operationBinding operationType="add" operationId="addContractor" serverMethod="addEditContractor">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.ContractorsDMI"/>
        </operationBinding>
        
		<!-- Contractor Update -->
		<operationBinding operationType="update" operationId="updateContractor" serverMethod="addEditContractor">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.ContractorsDMI"/>
        </operationBinding>
        
        <!-- Delete Contractor -->
		<operationBinding operationType="remove" operationId="removeContractor" serverMethod="removeContractor">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.ContractorsDMI"/>
        </operationBinding>
        
        <!-- Check Contractor -->
		<operationBinding operationType="update" operationId="checkContractorNumbers" serverMethod="checkContractorNumbers">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.ContractorsDMI"/>
        </operationBinding>
        
        <!-- Getting Contractor Call Count -->
		<operationBinding operationType="update" operationId="getContractorCallCnt" serverMethod="getContractorCallCnt">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.ContractorsDMI"/>
        </operationBinding>
        
        <!-- Getting Contractor Call Charges -->
		<operationBinding operationType="update" operationId="getContractorCharges" serverMethod="getContractorCharges">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.ContractorsDMI"/>
        </operationBinding>
        
        <!-- Block Contractor -->
		<operationBinding operationType="update" operationId="blockUnBlockContractor" serverMethod="blockUnBlockContractor">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.ContractorsDMI"/>
        </operationBinding>
        
        <!-- Contractor Range Price Update Manually -->
        <operationBinding operationType="update" operationId="updateContractorRangePrice" serverMethod="updateContractorRangePrice">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.ContractorsDMI"/>
        </operationBinding>
        
        
         <!-- Contractor Range Price Update Manually -->
        <operationBinding operationType="fetch" operationId="checkPhones" serverMethod="checkPhones">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.ContractorsDMI"/>
        </operationBinding>           
        
    	<operationBinding operationId="searchAllContractors" operationType="fetch">
    		<selectClause>   			
	    			t.corporate_client_id, 
					t.organization_id, 
					t.contract_start_date, 
					t.contract_end_date, 
					t.max_call_count, 
					t.call_price, 
					t.remark, 
					t.goverment, 
					t.price_type, 
					t.block, 
					t.sms_warning, 
					t.range_curr_price,
				  	mo1.organization_name,
				  	decode(t.price_type,0,'მარტ.','რთული') as price_type_descr,
				  	t.operator_src,
				  	t.mail_service_price
			</selectClause> 
			<tableClause>corporate_clients t, organizations mo1</tableClause>
			<whereClause><![CDATA[
				 t.organization_id = mo1.organization_id
				 #if($criteria.org_name) 
							#foreach($str in $criteria.org_name.split(" "))
								and mo1.organization_name like '%'||'$str'||'%'
							#end
				 #end
				 #if($criteria.goverment) and t.goverment = $criteria.goverment #end
				 #if($criteria.price_type) and t.price_type = $criteria.price_type #end
				 #if($criteria.phone)
				 	and t.corporate_client_id in (select tt.corporate_client_id from corp_client_phones tt where tt.phone_number = $criteria.phone) 				 	
				 #end
				 #if($criteria.limitType && $criteria.limitType == 0 ) and t.max_call_count <> -999999999 #end
				 #if($criteria.limitType && $criteria.limitType == 1 ) and t.max_call_count =  -999999999 #end
				 #if($criteria.corporate_client_id) and t.corporate_client_id =  $criteria.corporate_client_id #end
				 #if($criteria.operator_src) and t.operator_src =  $criteria.operator_src #end
				 
				]]>  
			</whereClause> 
			<orderClause>t.corporate_client_id</orderClause>
    	</operationBinding>
    	
    	
    	
    	
    	
    	<operationBinding operationId="getCallsCountByMainAndYM" operationType="fetch">
    		<selectClause>   		
    			  get_contractor_calls_count(to_number(to_char(sysdate,'YYMM')),t.corporate_client_id)	as contractor_call_cnt 			  
			</selectClause> 
			<tableClause>corporate_clients t</tableClause>
			<whereClause><![CDATA[
				 t.organization_id=$criteria.organization_id
				]]>  
			</whereClause> 			
    	</operationBinding>
    	
    	
    	<operationBinding operationId="getContractorsBilling1" operationType="add">
            <customSQL>
            	 <![CDATA[
            	 	{call makecontractorsbill($values.ym)}            	 	
            	 ]]>
            </customSQL> 
        </operationBinding>

		<operationBinding operationId="getFullContrBillMain1" operationType="fetch">
    		<selectClause>
    			  mo.organization_name,
			      t.call_count,
			      t.price as call_price,
			      t.amount,
			      decode(mo.ident_code_new,null,mo.ident_code,mo.ident_code_new) ident_code
			</selectClause> 
			<tableClause>corp_client_bill t, corporate_clients c, organizations mo </tableClause>
			<whereClause><![CDATA[
				 t.corporate_client_id = c.corporate_client_id and c.organization_id = mo.organization_id
				 and t.ym = $criteria.ym and t.amount> 0
				 #if($criteria.corporate_client_id) and c.corporate_client_id = $criteria.corporate_client_id #end	
				 #if($criteria.goverment) and c.goverment = $criteria.goverment #end
				 #if($criteria.operator_src) and c.operator_src = $criteria.operator_src #end
				]]>  
			</whereClause> 
			<orderClause>mo.organization_name</orderClause>
    	</operationBinding>
    	
    	<operationBinding operationId="getFullContrBillMain2" operationType="fetch">
    		<selectClause>
    			          tc.billing_company_name,
					      mo.organization_name,
					      s.service_description, 
					      bi.phone,
					      bi.call_date,
					      bi.charge_date,
					      bi.price as call_price
			</selectClause> 
			<tableClause> corp_client_bill_items bi, corporate_clients c, organizations mo, BILLING_COMPANIES tc, service_prices s </tableClause>
			<whereClause><![CDATA[
				 bi.corporate_client_id = c.corporate_client_id and c.organization_id = mo.organization_id and 				 
				 bi.billing_company_id = tc.billing_company_id(+) and  bi.service_id = s.service_price_id  and bi.ym = $criteria.ym
				 and bi.price > 0				 
				 #if($criteria.corporate_client_id) and c.corporate_client_id = $criteria.corporate_client_id #end				 
				 #if($criteria.goverment) and c.goverment = $criteria.goverment #end
				 #if($criteria.operator_src) and c.operator_src = $criteria.operator_src #end
				]]>  
			</whereClause> 
			<orderClause>bi.phone, bi.charge_date </orderClause>
    	</operationBinding>
    	
    	<operationBinding operationId="getFullContrBillMain3" operationType="fetch">
    		<selectClause>
    			           mo.organization_name,
					       bi.phone,
					       bi.call_date,
					       bi.session_id,
					       count(1) as charge_cnt
			</selectClause> 
			<tableClause>
			    		    ccare.corp_client_bill_items bi,
					        ccare.corporate_clients      c,
					        ccare.organizations          mo,
					        ccare.BILLING_COMPANIES      tc,
					        ccare.service_prices         s 
			</tableClause>
			<whereClause><![CDATA[
				 	   bi.corporate_client_id = c.corporate_client_id and 
				 	   c.organization_id = mo.organization_id and 
				 	   bi.billing_company_id = tc.billing_company_id(+) and 
				 	   bi.service_id = s.service_price_id and
				 	   bi.price > 0
				 	   
				 	   #if($criteria.ym) and bi.ym = $criteria.ym #end 
				 	    
				 	   #if($criteria.startDate) and trunc(bi.call_date) >= trunc($criteria.startDate) #end
				 	   #if($criteria.endDate) and trunc(bi.call_date) <= trunc($criteria.endDate) #end
				 				 
					   #if($criteria.corporate_client_id) and c.corporate_client_id = $criteria.corporate_client_id #end				 
					   #if($criteria.goverment) and c.goverment = $criteria.goverment #end
					   #if($criteria.operator_src) and c.operator_src = $criteria.operator_src #end
				]]>  
			</whereClause> 
			<groupClause> 
			    	   mo.organization_name,
				       bi.phone,
				       bi.call_date,
				       bi.session_id
       		</groupClause>
			<orderClause>bi.call_date </orderClause>
    	</operationBinding>
    	
    	
    </operationBindings>	
</DataSource>