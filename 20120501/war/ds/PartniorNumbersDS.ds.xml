<DataSource 
	ID="PartniorNumbersDS" 
	serverType="sql"
	tableName="PARTNIOR_TABLE" 
	qualifyColumnNames="false"
	dropExtraFields = "false">
	<fields>
		<field name="phone_number"   				type="integer"  		title="phone_number" 				primaryKey="true"/>
		<field name="subscriber_name"   			type="text"  			title="subscriber_name"/>
		<field name="address"   					type="text"  			title="address"/>
		<field name="subscriber_type"   			type="text"  			title="subscriber_type"/>
		<field name="phone_number_id"   			type="integer"  		title="phone_number_id"/>
		<field name="subscriber_id"   				type="integer"  		title="subscriber_id"/>
		<field name="org_department_ids"   			type="text"  			title="org_department_ids"/>
		<field name="org_department_count"   		type="integer"  		title="org_department_count"/>
		<field name="priority"   					type="integer"  		title="priority"/>
		<field name="subscriber_name_local"   		type="text"  			title="subscriber_name_local"/>
		<field name="subscriber_address"   			type="text"  			title="subscriber_address"/>
		<field name="organization_name"   			type="text"  			title="organization_name"/>
		<field name="organization_address"   		type="text"  			title="organization_address"/>
		<field name="need_subscriber"  				type="integer"  		title="need_subscriber"/>
		<field name="need_organisation"   			type="integer"  		title="need_organisation"/>
		<field name="has_organisation"   			type="boolean"   		title="need_organisation" 					sqlStorageStrategy="integer"/>
		<field name="has_subscriber"	   			type="boolean"   		title="need_organisation" 					sqlStorageStrategy="integer"/>
		<field name="subscriber_proceeded"  		type="integer"  		title="need_subscriber"/>
		<field name="organization_proceeded"   		type="text"  			title="need_organisation"/>
		<field name="loggedUserName" 				type="text"				title="address"/>
		
	</fields>
	<operationBindings>
	
		<operationBinding operationType="update" operationId="updatePartniorNumbers" serverMethod="updatePartniorNumbers">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.MiscDMI"/>
        </operationBinding>
		<operationBinding operationType="remove" operationId="deletePartniorNumbers" serverMethod="deletePartniorNumbers">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.MiscDMI"/>
        </operationBinding>
	
		<operationBinding operationId="customSearch"
			operationType="fetch">
			<selectClause><![CDATA[ 
				t.phone_number,
				t.subscriber_name,
				trim(t.address||' '||additional_address) address,
				t.additional_address,
				t.subscriber_type,
				t.phone_number_id,
				t.subscriber_id,
				t.org_department_ids,
				t.org_department_count,
				t.priority,
				#if($criteria.need_subscriber)
					/*t.subscriber_name_local 
					t.subscriber_address,*/
					decode(t.subscriber_id,null,null,t.subscriber_name_local||chr(13)||t.subscriber_address) subscriber_name_local,
				#end
				#if($criteria.need_organisation)
					/*decode(nvl(org_department_count,0),0,'',1,t.organization_name,t.org_department_count)  organization_name,
					t.organization_address,
					*/
					decode(nvl(org_department_count,0),0,'',1,t.organization_name||chr(13)||t.organization_address,t.org_department_count)  organization_name,
				#end
				#if($criteria.phone) p.need_subscriber #else 0 #end need_subscriber,
				#if($criteria.phone) p.need_organisation #else 0 #end need_organisation,
				decode(nvl(t.subscriber_id,-1),-1,0,1) has_subscriber,
				decode(nvl(t.org_department_count,-1),-1,null,0,0,1) has_organisation,
				organization_proceeded,
				subscriber_proceeded
				]]>
			</selectClause>
			<tableClause>
				PARTNIOR_TABLE t
				#if($criteria.phone),PARTNIOR_TABLE_PRIORITY p #end
			</tableClause>
			<whereClause><![CDATA[ 
				1=1
				#if($criteria.phone_number) and t.phone_number=$criteria.phone_number 
				#else
					#if($criteria.phone)
						and p.priority_id=t.priority and t.phone_number=$criteria.phone
					#else
						and t.priority= #if($criteria.priority) $criteria.priority #else 0 #end
					#end
				#end
			
			]]>
			</whereClause>
			<orderClause>t.priority, t.phone_number, t.org_department_count</orderClause>
		</operationBinding>
	</operationBindings>		
</DataSource>