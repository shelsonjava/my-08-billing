<DataSource
	ID="PubTranspDirDS"
	serverType="sql"
	tableName="ccare.PUBLIC_TRANSP_DIR"
	qualifyColumnNames="false"
	dropExtraFields = "false">
	<fields>
		<field name="pt_id"				type="integer"		title="ID"							hidden="true" primaryKey="true" />
		<field name="dir_num"			type="text"			title="Direction Number"/>		
		<field name="dir_old_num"		type="text"			title="Direction Old Number"/>
		<field name="cycle_descr"		type="text"			title="Cycle Description"/>
		<field name="service_descr"		type="text"			title="Service Description"/>
		<field name="cycled_id"			type="integer"		title="Cycle Id" 					hidden="true"/>
		<field name="service_id"		type="integer"		title="Service Id" 					hidden="true"/>
		<field name="loggedUserName"	type="text"			title="Logged UserName" 			hidden="true" />
		<field name="start_place"		type="text"			title="start_place"/>
		<field name="start_place_id"	type="integer"		title="start_place_id" 				hidden="true"/>
		<field name="end_place"			type="text"			title="end_place"/>
		<field name="end_place_id"		type="integer"		title="end_place_id" 				hidden="true"/>
		<field name="direction"			type="integer"		title="direction" 					hidden="true"/>
		<field name="remark_type"		type="integer"		title="remark_type" 				hidden="true"/>
		<field name="remark_type_descr"	type="text"			title="remark_type_descr" 			hidden="true"/>
		
		
	</fields>

	<operationBindings>		

		<serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.TransportDMI"/>

		<!-- Add Public Transport Direction -->
		<operationBinding operationType="add" operationId="addPublicTransportDirections" serverMethod="addPublicTransportDirections">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.TransportDMI"/>
        </operationBinding>
        
		<!-- Public Transport Direction Update -->
		<operationBinding operationType="update" operationId="updatePublicTransportDirections" serverMethod="updatePublicTransportDirections">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.TransportDMI"/>
        </operationBinding>
        
        <!-- Public Transport Direction Status Update -->
		<operationBinding operationType="update" operationId="updatePublicTransportDirectionsStatus" serverMethod="updatePublicTransportDirectionsStatus">
            <serverObject lookupStyle="new" className="com.info08.billing.callcenterbk.server.impl.dmi.TransportDMI"/>
        </operationBinding>
	
    	<operationBinding operationId="searchAllPublicTransportDirections" operationType="fetch">
    		<selectClause>   			
    			t.pt_id,
				t.dir_num,
				t.dir_old_num,
				decode(t.cycled_id,1,'ჩვეულებრივი',2,'წრიული','უცნობი') as cycle_descr,
				tt.NAME_DESCR as service_descr,
				t.cycled_id,	
				t.service_id,
				t.remark_type,
				getdescription(t.remark_type) as remark_type_descr
			</selectClause> 
			<tableClause>PUBLIC_TRANSP_DIR t, transp_types tt</tableClause>
			<whereClause><![CDATA[
				t.service_id = tt.TRANSP_TYPE_ID 
				#if($criteria.id) and t.id = $criteria.id #end
				#if($criteria.dir_num) and t.dir_num = $criteria.dir_num #end
				#if($criteria.dir_old_num) and t.dir_old_num = $criteria.dir_old_num #end
				#if($criteria.cycled_id) and t.cycled_id = $criteria.cycled_id #end
				#if($criteria.service_id) and t.service_id = $criteria.service_id #end
				]]>  
			</whereClause> 
			<orderClause>t.dir_num</orderClause>
    	</operationBinding>
    	
    	<operationBinding operationId="searchAllPublicTransportDirectionsForCombos" operationType="fetch">
    		<selectClause>   			
    			t.pt_id,
				t.dir_num || ' ( '|| tt.NAME_DESCR||' ) ' as dir_num
			</selectClause> 
			<tableClause>PUBLIC_TRANSP_DIR t, transp_types tt</tableClause>
			<whereClause><![CDATA[
				($defaultWhereClause) AND t.service_id = tt.TRANSP_TYPE_ID				
				]]>  
			</whereClause> 
			<orderClause>t.dir_num</orderClause>
    	</operationBinding>
    	
    	
    	
    	<operationBinding operationId="searchAllPublicTransportDirectionsForCallCenter" operationType="fetch">
    		<selectClause>
    			   tt.NAME_DESCR as service_descr,
    			   t.transportid as pt_id,
			       t.transportnodescr as dir_num,
			       getminbusstop(t.transportid) start_place,
			       getminbusstop_id(t.transportid) start_place_id,
			       getmaxbusstop(t.transportid) end_place,
			       getmaxbusstop_id(t.transportid) end_place_id,
			       t.CYCLED_ID direction,
			       decode(t.CYCLED_ID,1,'ჩვეულებრივი',2,'წრიული','უცნობი') as cycle_descr
			</selectClause> 
			<tableClause>incity_transport_view_new t, ccare.transp_types tt</tableClause>
			<whereClause><![CDATA[
				t.transport_type_id = tt.transp_type_id
				#if($criteria.transport_type_id) and t.transport_type_id = $criteria.transport_type_id #end
				#if($criteria.transportno) and (t.transportno = $criteria.transportno) #end
				
				#if($criteria.start_place_id1) 
					and t.transportid in (select tt.route_id from ccare.bus_route_streets tt , ccare.streets str
						where tt.street_id = str.street_id and trim(str.street_name ||' '||tt.notes) like '%'||$criteria.start_place_id1||'%')			 
				#end
				#if($criteria.start_place_id2) 
					and t.transportid in (select tt.route_id from ccare.bus_route_streets tt , ccare.streets str
						where tt.street_id = str.street_id and trim(str.street_name ||' '||tt.notes) like '%'||$criteria.start_place_id2||'%')
				#end
				#if($criteria.start_place_id3) 
					and t.transportid in (select tt.route_id from ccare.bus_route_streets tt , ccare.streets str
						where tt.street_id = str.street_id and trim(str.street_name ||' '||tt.notes) like '%'||$criteria.start_place_id3||'%')			 
				#end
				#if($criteria.start_place_id4) 
					and t.transportid in (select tt.route_id from ccare.bus_route_streets tt , ccare.streets str
						where tt.street_id = str.street_id and trim(str.street_name ||' '||tt.notes) like '%'||$criteria.start_place_id4||'%')			 
				#end
				#if($criteria.start_place_id5) 
					and t.transportid in (select tt.route_id from ccare.bus_route_streets tt , ccare.streets str
						where tt.street_id = str.street_id and trim(str.street_name ||' '||tt.notes) like '%'||$criteria.start_place_id5||'%')
				#end
				
				#if($criteria.end_place_id1)
					and t.transportid in (select tt.route_id from ccare.bus_route_streets tt , ccare.streets str
						where tt.street_id = str.street_id and trim(str.street_name ||' '||tt.notes) like '%'||$criteria.end_place_id1||'%')			 	
				#end
				#if($criteria.end_place_id2)
					and t.transportid in (select tt.route_id from ccare.bus_route_streets tt , ccare.streets str
						where tt.street_id = str.street_id and trim(str.street_name ||' '||tt.notes) like '%'||$criteria.end_place_id2||'%')
				#end
				#if($criteria.end_place_id3)
					and t.transportid in (select tt.route_id from ccare.bus_route_streets tt , ccare.streets str
						where tt.street_id = str.street_id and trim(str.street_name ||' '||tt.notes) like '%'||$criteria.end_place_id3||'%')				 	
				#end
				#if($criteria.end_place_id4)
					and t.transportid in (select tt.route_id from ccare.bus_route_streets tt , ccare.streets str
						where tt.street_id = str.street_id and trim(str.street_name ||' '||tt.notes) like '%'||$criteria.end_place_id4||'%')				 	
				#end
				#if($criteria.end_place_id5)
					and t.transportid in (select tt.route_id from ccare.bus_route_streets tt , ccare.streets str
						where tt.street_id = str.street_id and trim(str.street_name ||' '||tt.notes) like '%'||$criteria.end_place_id5||'%')				 	
				#end					
				]]>  
			</whereClause> 
			<groupClause>tt.NAME_DESCR, t.transportid, t.transportnodescr,  t.CYCLED_ID</groupClause>
			<orderClause>t.transportNoDescr</orderClause>
    	</operationBinding>
    	
    </operationBindings>	
</DataSource>